# Development Dockerfile for Physical AI & Humanoid Robotics Book
FROM osrf/ros:humble-desktop-full

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive
ENV ROS_DISTRO=humble
ENV PYTHONUNBUFFERED=1

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    curl \
    wget \
    python3-pip \
    nodejs \
    npm \
    build-essential \
    cmake \
    python3-dev \
    python3-colcon-common-extensions \
    python3-rosdep2 \
    && rm -rf /var/lib/apt/lists/*

# Install Node.js 18+ if not available
RUN if ! command -v nodejs &> /dev/null; then \
        curl -fsSL https://deb.nodesource.com/setup_18.x | bash - && \
        apt-get install -y nodejs; \
    fi

# Set up ROS2 environment
SHELL ["/bin/bash", "-c"]
RUN source /opt/ros/humble/setup.bash && \
    echo "source /opt/ros/humble/setup.bash" >> ~/.bashrc

# Create workspace directory
WORKDIR /workspace

# Copy requirements file
COPY requirements.txt .

# Install Python dependencies
RUN pip3 install --upgrade pip && \
    pip3 install -r requirements.txt

# Create directory structure
RUN mkdir -p ros2_ws/src my-book

# Set up the development environment
EXPOSE 3000

# Default command
CMD ["bash"]